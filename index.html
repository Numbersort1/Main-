<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wingo 1-Min Prediction</title>
<style>
body { margin:0; font-family:'Poppins',sans-serif; background:linear-gradient(180deg,#0f2027,#203a43,#2c5364); color:#fff; text-align:center; }
.container { width:95%; max-width:500px; margin:15px auto; padding:15px; background:rgba(255,255,255,0.05); border-radius:15px; backdrop-filter:blur(12px); box-shadow:0 0 25px rgba(0,255,255,0.3);}
.title-box { font-size:24px; font-weight:700; padding:12px; border:2px solid #0af; border-radius:12px; text-shadow:0 0 10px #0af; margin-bottom:15px; }
.balance-box { display:flex; justify-content:space-between; align-items:center; background:rgba(255,255,255,0.1); padding:10px 15px; border-radius:12px; margin-bottom:12px; font-weight:600;}
.tower { display:flex; flex-direction:column; justify-content:flex-end; align-items:flex-end; height:30px; width:25px; }
.bar { width:5px; background:#0a84ff; margin-top:2px; border-radius:2px; }
.bar:n;
th-child(1){height:5px; opacity:.4;} .bar:nth-child(2){height:10px;opacity:.6;} .bar:nth-child(3){height:15px;opacity:.8;} .bar:nth-child(4){height:20px;}
.start-box { display:flex; justify-content:center; flex-wrap:wrap; gap:8px; margin-bottom:12px; }
.start-btn,.multiplier-btn { cursor:pointer; border:none; border-radius:10px; font-weight:600; padding:8px 20px; }
.start-btn { background:#0a84ff; color:#fff; font-size:16px; box-shadow:0 0 10px #0af; }
.multiplier-btn { background:#f0f0f0; color:#111; font-size:14px; }
.multiplier-btn.selected { border:2px solid #0af; box-shadow:0 0 10px #0af; }
.period-box { display:flex; justify-content:space-between; background:rgba(255,255,255,0.1); padding:10px 15px; border-radius:12px; margin-bottom:12px; font-size:16px; font-weight:600; }
.color-row { display:flex; justify-content:space-between; margin-bottom:6px; }
.color-box { flex:1; margin:2px; padding:12px 0; border-radius:50%; opacity:0.4; transition:.3s; color:#fff; font-weight:600; text-align:center; font-size:16px; cursor:pointer; }
.color-box.red {background:#e74c3c;} 
.color-box.green {background:#2ecc71;} 
.color-box.violet {background:#9b59b6;}
.color-box.active { opacity:1; animation: glowPulse 1s infinite alternate; }
@keyframes glowPulse { 0% { box-shadow:0 0 10px #fff,0 0 15px #0af; } 100% { box-shadow:0 0 20px #fff,0 0 30px #0af; } }
.bigsmall-box { display:flex; justify-content:space-around; background:rgba(255,255,255,0.1); padding:10px 0; border-radius:10px; font-weight:600; margin-bottom:12px; }
.bigsmall-box .active { text-shadow:0 0 12px #0af; font-size:18px; }
.history-box { background:rgba(255,255,255,0.05); padding:10px; border-radius:12px; text-align:left; max-height:250px; overflow-y:auto; margin-top:10px;}
.history-box table { width:100%; border-collapse:collapse; }
.history-box th, .history-box td { border:1px solid #0af; padding:6px; font-size:14px; text-align:center; }
.popup { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.95); padding:20px; border-radius:12px; border:2px solid #0af; display:none; z-index:999; width:90%; max-width:300px; }
.popup div { margin-bottom:12px; font-weight:600; }
.popup button { margin:5px; padding:8px 15px; border:none; border-radius:8px; cursor:pointer; font-weight:600; }
.winBtn { background:#2ecc71; color:#fff; }
.lossBtn { background:#e74c3c; color:#fff; }
</style>
</head>
<body>
<div class="container">
  <div class="title-box">Wingo 1-Min Prediction</div>
  <div class="balance-box">
    <div id="balanceDisplay">Balance: ₹0</div>
    <div class="tower">
      <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
    </div>
  </div>
  <div class="start-box">
    <button class="start-btn" id="startBtn">Start</button>
    <button class="multiplier-btn" data-multiplier="5">5x</button>
    <button class="multiplier-btn" data-multiplier="10">10x</button>
    <button class="multiplier-btn" data-multiplier="20">20x</button>
    <button class="multiplier-btn" data-multiplier="30">30x</button>
  </div>
  <div class="period-box">
    <div id="period">Period: --</div>
    <div id="timer">60</div>
  </div>
  <div class="color-row" id="row0to4"></div>
  <div class="color-row" id="row5to9"></div>
  <div class="bigsmall-box">
    <div id="bigBox">BIGG</div>
    <div id="smallBox">SMALL</div>
  </div>
  <div class="history-box">
    <table id="historyTable">
      <thead><tr><th>Period</th><th>Predicted</th><th>Win/Loss</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<div class="popup" id="popup">
  <div>Period: <span id="popupPeriod">--</span></div>
  <div>Predicted: <span id="popupPrediction">--</span></div>
  <button class="winBtn" id="winBtn">WIN</button>
  <button class="lossBtn" id="lossBtn">LOSS</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getFirestore, collection, query, where, getDocs, doc, updateDoc, addDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBpm5DrG0PviHogVVWLi40UBoUcvqxS0kE",
  authDomain: "ttcc-588da.firebaseapp.com",
  projectId: "ttcc-588da",
  storageBucket: "ttcc-588da.firebasestorage.app",
  messagingSenderId: "150570431773",
  appId: "1:150570431773:web:69808344c656adfbc79df4"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const row0to4 = document.getElementById("row0to4");
const row5to9 = document.getElementById("row5to9");
const historyTableBody = document.querySelector("#historyTable tbody");
const popup = document.getElementById("popup");
const popupPeriod = document.getElementById("popupPeriod");
const popupPrediction = document.getElementById("popupPrediction");
const winBtn = document.getElementById("winBtn");
const lossBtn = document.getElementById("lossBtn");
const balanceDisplay = document.getElementById("balanceDisplay");
const bigBox = document.getElementById("bigBox");
const smallBox = document.getElementById("smallBox");

let username = localStorage.getItem("username");
let email = localStorage.getItem("email");
let multiplier = 0;
let remainingPredictions = 0;
let userBalance = 0;
let activePrediction = null;
let lastPeriod = null;
let lastPrediction = null;
let lastResult = null;

// Create number balls
for(let i=0;i<10;i++){
  const box=document.createElement("div");
  box.className="color-box";
  box.textContent=i;
  if(i===0||i===5) box.classList.add("violet");
  else if(i%2===0) box.classList.add("red");
  else box.classList.add("green");
  if(i<=4) row0to4.appendChild(box);
  else row5to9.appendChild(box);
}

// Multiplier buttons
document.querySelectorAll(".multiplier-btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    if(remainingPredictions>0) return;
    document.querySelectorAll(".multiplier-btn").forEach(b=>b.classList.remove("selected"));
    btn.classList.add("selected");
    multiplier=parseInt(btn.dataset.multiplier);
  });
});

// Start button
document.getElementById("startBtn").addEventListener("click",()=>{
  if(multiplier===0){ alert("Select multiplier!"); return; }
  remainingPredictions=multiplier;
  alert(`Prediction session started! ${remainingPredictions} predictions will be made`);
});

// Period calculation
function getPeriodNumber(){
  const now=new Date();
  const midnight = new Date(); midnight.setHours(0,0,0,0);
  const minutesPassed = Math.floor((now-midnight)/(1000*60));
  const yyyy=now.getFullYear();
  const mm=String(now.getMonth()+1).padStart(2,'0');
  const dd=String(now.getDate()).padStart(2,'0');
  return `${yyyy}${mm}${dd}${String(minutesPassed+1).padStart(5,'0')}`;
}

// Timer
function updateTimer(){
  const now=new Date();
  const secondsRemaining=60-now.getSeconds();
  document.getElementById("timer").textContent=secondsRemaining;
  const currentPeriod = getPeriodNumber();
  document.getElementById("period").textContent="Period: "+currentPeriod;

  if(currentPeriod!==lastPeriod){
    // Show last period popup if pending
    if(lastPrediction!==null && lastResult===null){
      popupPeriod.textContent = lastPeriod;
      popupPrediction.textContent = lastPrediction;
      popup.style.display="flex";
      const popupTimeout = setTimeout(()=>{ recordResult("LOSS"); },10000);
      winBtn.onclick = ()=>{ clearTimeout(popupTimeout); recordResult("WIN"); };
      lossBtn.onclick = ()=>{ clearTimeout(popupTimeout); recordResult("LOSS"); };
    }
    lastPeriod = currentPeriod;
    if(remainingPredictions>0){
      generatePrediction();
    }
  }
}
setInterval(updateTimer,1000);

// Glow prediction and BIGG/SMALL highlight
function glowPrediction(number){
  document.querySelectorAll(".color-box").forEach(b=>b.classList.remove("active"));
  document.querySelectorAll(".color-box").forEach(box=>{
    if(parseInt(box.textContent)===number) box.classList.add("active");
  });
  bigBox.classList.remove("active");
  smallBox.classList.remove("active");
  if(number>=5) bigBox.classList.add("active");
  else smallBox.classList.add("active");
}

// Load balance
async function loadBalance(){
  if(!username || !email) return;
  const usersRef = collection(db,"users");
  const q = query(usersRef,where("username","==",username),where("email","==",email));
  const querySnapshot = await getDocs(q);
  if(!querySnapshot.empty){
    const data = querySnapshot.docs[0].data();
    userBalance = data.balance || 0;
    balanceDisplay.textContent = "Balance: ₹"+userBalance;
  }
}

// Update balance
async function updateBalance(newBalance){
  userBalance = newBalance;
  balanceDisplay.textContent="Balance: ₹"+userBalance;
  const usersRef = collection(db,"users");
  const q = query(usersRef,where("username","==",username),where("email","==",email));
  const querySnapshot = await getDocs(q);
  if(!querySnapshot.empty){
    const userDoc = querySnapshot.docs[0].ref;
    await updateDoc(userDoc,{balance:userBalance});
  }
}

// Record prediction to Firestore
async function recordPrediction(period,prediction,result){
  const gameHistoryRef = collection(db,"gameHistory");
  await addDoc(gameHistoryRef,{
    username,
    email,
    period,
    game:"Wingo 1-Min",
    predictions:prediction,
    result:result,
    timestamp:new Date()
  });
}

// Generate prediction
function generatePrediction(){
  if(remainingPredictions<=0 || userBalance<50) return;
  const number = Math.floor(Math.random()*10);
  activePrediction = number;
  lastPrediction = number;
  lastResult = null;
  glowPrediction(number);
}

// Record result
async function recordResult(result){
  if(activePrediction===null && lastPrediction===null) return;
  const periodToRecord = lastPeriod;
  const predictionToRecord = lastPrediction;
  lastResult = result;
  updateBalance(userBalance-50);
  // Update table
  const row = document.createElement("tr");
  row.innerHTML = `<td>${periodToRecord}</td><td>${predictionToRecord}</td><td>${result}</td>`;
  historyTableBody.insertBefore(row, historyTableBody.firstChild);
  if(historyTableBody.children.length>30) historyTableBody.removeChild(historyTableBody.lastChild);

  // Record in Firestore
  await recordPrediction(periodToRecord,predictionToRecord,result);

  remainingPredictions--;
  activePrediction=null;
  popup.style.display="none";
}

// Load initial balance
loadBalance();
</script>
</body>
</html>